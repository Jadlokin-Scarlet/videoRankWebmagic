<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jadlokin.test.mapper.VideoDataMapper">
  <select id="selectAllForPage" resultMap="com.jadlokin.test.mapper.VideoDataBaseMapper.BaseResultMap">
    select av, [page]
    from video_data
  </select>
  <select id="selectAllDisparityBetweenTwoIssue" resultMap="com.jadlokin.test.mapper.VideoDataBaseMapper.BaseResultMap">
    select
      new.av as av,
      new.[view] - case when old.[view] is NULL then 0 else old.[view] end as [view],
      new.reply - case when old.reply is NULL then 0 else old.reply end as reply,
      new.favorite - case when old.favorite is NULL then 0 else old.favorite end as favorite,
      new.coin - case when old.coin is NULL then 0 else old.coin end as coin,
      new.page as page
    from
      (select * from video_data where issue = 0) as old right JOIN
      (select * from video_data where issue = 1) as new on old.av = new.av

  </select>
  <select id="selectAllForIssue" resultMap="com.jadlokin.test.mapper.VideoDataBaseMapper.BaseResultMap">
    select av, issue
    from video_data
  </select>
  <update id="updateAllIssue" parameterType="VideoData">
    update video_data
    set issue = #{issue,jdbcType=NVARCHAR}
    where av = #{av,jdbcType=NUMERIC};
  </update>
</mapper>